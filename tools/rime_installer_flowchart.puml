@startuml rime_installer_flowchart
title RIME TLPA å°èªè¼¸å…¥æ³•å®‰è£ç¨‹å¼æµç¨‹åœ–

start

:ç¨‹å¼å•Ÿå‹•;
:å»ºç«‹ RimeInstaller å¯¦ä¾‹ <<procedure>>;
note right
  æ™ºèƒ½æª¢æ¸¬è³‡æºç›®éŒ„ä½ç½®:
  - ç•¶å‰ç›®éŒ„
  - åŸ·è¡Œæª”ç›®éŒ„
  - ä¸Šç´šç›®éŒ„
  - åŸ·è¡Œæª”ä¸Šç´šç›®éŒ„
end note

:åŸ·è¡Œ install() æ–¹æ³•;

:é¡¯ç¤ºå®‰è£ç¨‹å¼æ¨™é¡Œ;

:æª¢æŸ¥ RIME æ˜¯å¦å·²å®‰è£ <<procedure>>;
if (RIME é…ç½®ç›®éŒ„å­˜åœ¨?) then (æ˜¯)
  :âœ… æ‰¾åˆ° RIME é…ç½®ç›®éŒ„;
else (å¦)
  :âŒ RIME é…ç½®ç›®éŒ„ä¸å­˜åœ¨;
  :æç¤ºå®‰è£ RIME å°ç‹¼æ¯«;
  stop
endif

:å‚™ä»½ç¾æœ‰çš„ default.custom.yaml <<procedure>>;
if (default.custom.yaml å­˜åœ¨?) then (æ˜¯)
  :å»ºç«‹æ™‚é–“æˆ³è¨˜å‚™ä»½æª”æ¡ˆ;
  :ğŸ“‹ è¤‡è£½å‚™ä»½æª”æ¡ˆ;
else (å¦)
  :ğŸ“‹ ç„¡éœ€å‚™ä»½;
endif

:å‚™ä»½å…¶ä»–ç¾æœ‰æª”æ¡ˆ <<procedure>>;
note right
  å‚™ä»½æª”æ¡ˆåˆ—è¡¨:
  - rime.lua
  - custom_phrase.txt
end note

partition "è¤‡è£½ RIME é…ç½®æª”æ¡ˆ" {
  :æª¢æŸ¥æ˜¯å¦æœ‰ rime_files ç›®éŒ„ <<procedure>>;

  if (rime_files ç›®éŒ„å­˜åœ¨?) then (æ˜¯)
    :ğŸ“ å¾ rime_files ç›®éŒ„è¤‡è£½æ‰€æœ‰æª”æ¡ˆ;
    :éæ­· rime_files ç›®éŒ„ä¸­çš„æª”æ¡ˆ;
    while (é‚„æœ‰æª”æ¡ˆ?) is (æ˜¯)
      :è¤‡è£½æª”æ¡ˆåˆ° RIME é…ç½®ç›®éŒ„;
      if (è¤‡è£½æˆåŠŸ?) then (æ˜¯)
        :âœ… è¨˜éŒ„æˆåŠŸ;
        :æˆåŠŸè¨ˆæ•¸ +1;
      else (å¦)
        :âŒ è¨˜éŒ„å¤±æ•—;
        :åŠ å…¥å¤±æ•—æ¸…å–®;
      endif
    endwhile (å¦)
  else (å¦)
    :ğŸ“‹ å¾ release-include.txt è¤‡è£½æª”æ¡ˆ;
    :è§£æ release-include.txt;
    while (é‚„æœ‰æª”æ¡ˆ?) is (æ˜¯)
      if (ä¾†æºæª”æ¡ˆå­˜åœ¨?) then (æ˜¯)
        :è¤‡è£½æª”æ¡ˆåˆ° RIME é…ç½®ç›®éŒ„;
        if (è¤‡è£½æˆåŠŸ?) then (æ˜¯)
          :âœ… è¨˜éŒ„æˆåŠŸ;
          :æˆåŠŸè¨ˆæ•¸ +1;
        else (å¦)
          :âŒ è¨˜éŒ„å¤±æ•—;
          :åŠ å…¥å¤±æ•—æ¸…å–®;
        endif
      else (å¦)
        :âš ï¸ æª”æ¡ˆä¸å­˜åœ¨;
        :åŠ å…¥å¤±æ•—æ¸…å–®;
      endif
    endwhile (å¦)
  endif

  :ğŸ“Š é¡¯ç¤ºè¤‡è£½çµæœçµ±è¨ˆ;
}

:è¤‡è£½æ–°çš„ default.custom.yaml <<procedure>>;
if (rime_files/default.custom.yaml å­˜åœ¨?) then (æ˜¯)
  :âœ… å¾ rime_files è¤‡è£½;
else (å¦)
  if (config/default.custom.yaml å­˜åœ¨?) then (æ˜¯)
    :âœ… å¾ config è¤‡è£½;
  else (å¦)
    :âš ï¸ æ‰¾ä¸åˆ° default.custom.yaml;
  endif
endif

:ğŸ”„ å˜—è©¦è§¸ç™¼ RIME é‡æ–°éƒ¨ç½² <<procedure>>;
:æœå°‹ WeaselDeployer.exe;
if (æ‰¾åˆ°éƒ¨ç½²ç¨‹å¼?) then (æ˜¯)
  :åŸ·è¡Œ WeaselDeployer.exe /deploy;
  if (éƒ¨ç½²æˆåŠŸ?) then (æ˜¯)
    :âœ… RIME é‡æ–°éƒ¨ç½²æˆåŠŸ;
  else (å¦)
    :âš ï¸ è‡ªå‹•éƒ¨ç½²å¤±æ•—;
  endif
else (å¦)
  :âš ï¸ æ‰¾ä¸åˆ°éƒ¨ç½²ç¨‹å¼;
endif

:é¡¯ç¤ºå®‰è£å®Œæˆè¨Šæ¯;
:ğŸ“ é¡¯ç¤ºå¾ŒçºŒæ­¥é©Ÿèªªæ˜;
:ğŸ“Š é¡¯ç¤ºå®‰è£çµ±è¨ˆ;

if (æœ‰å¤±æ•—æª”æ¡ˆ?) then (æ˜¯)
  :âš ï¸ éƒ¨åˆ†å•é¡Œ;
else (å¦)
  :âœ… å…¨éƒ¨æˆåŠŸ;
endif

:æŒ‰ Enter éµçµæŸ;

stop

@enduml